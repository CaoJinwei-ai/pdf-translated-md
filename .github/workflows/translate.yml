name: PDF自动翻译+转MD
on:
  push:
    paths:
      - "input_pdf/**.pdf"
  workflow_dispatch:

jobs:
  translate:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 安装Python环境
        uses: actions/setup-python@v5
        with:
          python-version: "3.10.12"

      - name: 安装基础依赖（仅装能成功的包）
        run: |
          pip install --upgrade pip
          pip install pymupdf==1.25.2 markdownify==1.2.2

      - name: 执行翻译脚本（基础流程）
        run: python translate_pdf.py

      - name: 配置Git用户
        run: |
          git config --global user.name "CaoJinwei-ai"
          git config --global user.email "你的GitHub绑定邮箱"  # 替换成实际邮箱

      - name: 自动提交结果到output
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "✅ 完成PDF解析，生成原始文本文件"
          file_pattern: "output/**"
          push_options: "--force"